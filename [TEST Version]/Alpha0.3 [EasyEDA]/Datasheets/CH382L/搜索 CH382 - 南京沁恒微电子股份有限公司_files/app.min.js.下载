var search_option = function () {

    var a = $("#navbar-search-panel .dropdown-menu li a.option-search-a");

    a.click(function () {
        var name = $(this).attr('name');
        var text = $(this).text();
        $("#navbar-search-option-text").html(text);
        $("#navbar-search-option-hidden").val(name);
        $("#navbar-search-option-panel #navbar-search-option-menu").hide();
    })


    $("#navbar-search-option").click(function () {
        $("#navbar-search-option-panel #navbar-search-option-menu").show();
    })

    $("#navbar-search-option-panel #navbar-search-option-menu").mouseleave(function () {
        $("#navbar-search-option-panel #navbar-search-option-menu").hide();
    })

    $("#navbar-search-input").focus(function () {
       // console.log("sdfsdf");
        var q = $("#navbar-search-input").val();
        if(q.length == 0){
            $("#navbar-search-hot").show();
        }

    })





}

var search_btn = function () {
    $(".search-btn").click(function(){
        $(this).parent("form").submit();
    })
    $(".search-form").submit(function(){
        var q = $(this).children("[name=q]").val()
        if (q.length == 0) {
            alert("搜索关键字不能为空");
            return false;
        } 
    })

    
}


var navDropdown = function () {
    $("#site-nav li.pli").hover(function () {
        $(this).addClass('active');
        $(this).find('.nav-panel').slideDown();
        $(this).find('.dropdown-menu').slideDown();
    }, function () {
        $(this).removeClass('active');
        $(this).find('.nav-panel').hide();
        $(this).find('.dropdown-menu').hide();
    })

    $(".dropdown-menu-li").hover(function () {
        $(this).addClass('active');
        $(this).find('.dropdown-menu-multi').css('left', $(this).width());


        $(this).find('.dropdown-menu-multi').slideDown();
    }, function () {
        $(this).removeClass('active');
        $(this).find('.dropdown-menu-multi').hide();
    })
}


var selectLanguage = function () {
    $(".select-language").click(function () {
         if($('.select-language-ul').css('display') === 'block' ){
             $(".select-language-ul").hide();
         }else{
             $(".select-language-ul").slideDown();
         }

    })
    // $("#select-language-card")   .focusout(function () {
    //     $(".select-language-ul").hide();
    // })


}


var btn_product_add = function () {
    var product_index = $(".product-num-value:last").attr('index');
    var product_model_name = $("#product_model_name").val();
    var num_name = $("#num_name").val();
    $('#btn-product-add').click(function () {
        product_index = parseInt(product_index) + 1;
        var html = "<div class='form-group'>"
            + "<label for ='product_model" + product_index + "'   class='col-sm-3 control-label'>" + product_model_name + product_index + "</label>"
            + "<div class='col-sm-9'><input type='text' id='product_model" + product_index + "' name='product_model[]' class='form-control' placeholder='" + product_model_name + product_index + "'>"
            + "</div></div>"
            + " <div class='form-group product-num'>"
            + "<label for='num" + product_index + "' class='col-sm-3 control-label'>" + num_name + product_index + "</label>"
            + "<div class='col-sm-9'><input type='text' id='num" + product_index + "' name='num[]' class='form-control' placeholder='" + num_name + product_index + "'>"
            + "</div></div>";
        $(".product-num:last").after(html);
    })
};


var featureTableLength = function () {

    var table_count = $('.feature-card-body table').length;

    for (var i = 0; i < table_count; i++) {
        var table = $(".feature-card-body table:eq(" + i + ")");
        var tr_length = table.find('tr:eq(1)').find('td').length;
        if (tr_length <= 9) {
            table.css('width', '100%');
            table.parent().css('overflow', 'hidden');
        }
    }
}


var rowspanColor = function () {
    var table_count = $('.feature-card-body table').length;
    for (var i = 0; i < table_count; i++) {
        var table = $(".feature-card-body table:eq(" + i + ")");
        table.find('tr:first').find("td").each(function (td_index, td_item) {
            var colspan_count = $(td_item).attr("colspan");
            if (colspan_count > 1) {
                table.find("tr:eq(1)").css("background-color", "#eee");
            }
        })
    }
}


var tdWidth = function () {
    var table_count = $('.feature-card-body table').length;
    for (var i = 0; i < table_count; i++) {

        var table = $(".feature-card-body table:eq(" + i + ")");
        table.removeAttr("style");
        table.find('tr:first').find("td").each(function (td_index, td_item) {
            var td_value = $(td_item).text();
            if (td_value.indexOf("@") > -1) {
                var td_value_arr = td_value.split('#')
                $(td_item).text(td_value_arr[2]);
                $(td_item).css('width', td_value_arr[1] + 'px')

            }
        })
        table.find('tr:eq(1)').find("td").each(function (td_index, td_item) {
            var td_value = $(td_item).text();
            if (td_value.indexOf("@") > -1) {
                var td_value_arr = td_value.split('#')
                $(td_item).text(td_value_arr[2]);
                $(td_item).css('width', td_value_arr[1] + 'px')

            }
        })
    }
}


var mcuTdWidth = function () {
    var table_count = $('.mcu_guide').find("table").length;
    for (var i = 0; i < table_count; i++) {
        var table = $(".mcu_guide table:eq(" + i + ")");
        table.removeAttr("style");
        table.find('tr:first').find("td").each(function (td_index, td_item) {
            var td_value = $(td_item).text();
            if (td_value.indexOf("@") > -1) {
                var td_value_arr = td_value.split('#')
                $(td_item).text(td_value_arr[2]);
                $(td_item).css('width', td_value_arr[1] + 'px')

            }
        })
    }
}


var navbarSearch = function(){
    $("#navbar-mob-search").click(function(){
        window.location.href = "/search"
    })
}

var navbarToggle = function () {
    $("#navbar-mob-toggle").click(function () {
        $("#navbar-mob-toggle").hide();
        $("#navbar-mob-toggle-close").show();
        $("#wch_mob_nav_container").animate({right: 0})
    })

    $("#navbar-mob-toggle-close").click(function () {
        $("#navbar-mob-toggle-close").hide();
        $("#navbar-mob-toggle").show();
        $("#wch_mob_nav_container").animate({right: "-100%"})
    })


    $("#mob-search-close").click(function () {
        $("#wch-mob-search").animate({top: "-88px"})
    })

    $("#navbar-mob-toggle-search").click(function () {
        $("#wch-mob-search").animate({top: "42px"})
    })

    $("#mob-search-btn").click(function () {
        var q = $("#mob-search-input").val();
        if (q.length == 0) {
            alert("搜索关键字不能为空")
        } else {
            $("#mob-search-form").submit();
        }
    })
}


$('.index-box a').tooltip();

$('#flash-overlay-modal').modal();

$(document).ready(function () {
    tdWidth();
    mcuTdWidth();
    rowspanColor();
    featureTableLength();
    btn_product_add();
    search_option();
    search_btn();
    navDropdown();
    navbarToggle();
    navbarSearch();
    selectLanguage();
})